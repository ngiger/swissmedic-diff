<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: SwissmedicDiff::Diff</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">SwissmedicDiff::Diff</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/swissmedic-diff_rb.html">
                lib/swissmedic-diff.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000014">_comparable</a>&nbsp;&nbsp;
      <a href="#M000009">_known_data</a>&nbsp;&nbsp;
      <a href="#M000013">_sort_by</a>&nbsp;&nbsp;
      <a href="#M000001">capitalize</a>&nbsp;&nbsp;
      <a href="#M000002">cell</a>&nbsp;&nbsp;
      <a href="#M000003">column</a>&nbsp;&nbsp;
      <a href="#M000004">describe</a>&nbsp;&nbsp;
      <a href="#M000005">describe_flag</a>&nbsp;&nbsp;
      <a href="#M000006">diff</a>&nbsp;&nbsp;
      <a href="#M000007">format_flags</a>&nbsp;&nbsp;
      <a href="#M000008">known_data</a>&nbsp;&nbsp;
      <a href="#M000010">name</a>&nbsp;&nbsp;
      <a href="#M000011">rows_diff</a>&nbsp;&nbsp;
      <a href="#M000012">to_s</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">COLUMNS</td>
          <td>=</td>
          <td class="context-item-value">[ :iksnr, :seqnr, :name_base, :company, :product_group,                 :index_therapeuticus, :atc_class, :production_science,                 :registration_date, :sequence_date, :expiry_date, :ikscd,                 :size, :unit, :ikscat, :substances, :composition,                 :indication_registration, :indication_sequence ]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FLAGS</td>
          <td>=</td>
          <td class="context-item-value">{       :new                      =&gt;  'Neues Produkt',       :name_base                =&gt;  'Namensänderung',       :ikscat                   =&gt;  'Abgabekategorie',       :index_therapeuticus      =&gt;  'Index Therapeuticus',       :indication_registration  =&gt;  'Anwendungsgebiet Präparate',       :indication_sequence      =&gt;  'Anwendungsgebiet Sequenz',       :company                  =&gt;  'Zulassungsinhaber',       :composition              =&gt;  'Zusammensetzung',       :sequence                 =&gt;  'Packungen',       :size                     =&gt;  'Packungsgrösse',       :expiry_date              =&gt;  'Ablaufdatum der Zulassung',       :registration_date        =&gt;  'Erstzulassungsdatum',       :sequence_date            =&gt;  'Zulassungsdatum Sequenz',       :delete                   =&gt;  'Das Produkt wurde gelöscht',       :replaced_package         =&gt;  'Packungs-Nummer',       :substances               =&gt;  'Wirkstoffe',       :production_science       =&gt;  'Heilmittelcode',       :atc_class                =&gt;  'ATC-Code',     }</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">GALFORM_P</td>
          <td>=</td>
          <td class="context-item-value">%r{excipiens\s+(ad|pro)\s+(?&lt;galform&gt;((?!\bpro\b)[^.])+)}</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">_comparable</span><span class="method-args">(key, row, idx)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 272</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_comparable</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">row</span>, <span class="ruby-identifier">idx</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cell</span> = <span class="ruby-identifier">row</span>[<span class="ruby-identifier">idx</span>]
        <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">key</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:registration_date</span>, <span class="ruby-identifier">:expiry_date</span>
          <span class="ruby-identifier">row</span>[<span class="ruby-identifier">idx</span>]
        <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:seqnr</span>
          <span class="ruby-identifier">sprintf</span> <span class="ruby-value str">&quot;%02i&quot;</span>, <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">idx</span>).<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\s+/</span>, <span class="ruby-value str">&quot;&quot;</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">_known_data</span><span class="method-args">(latest, known_regs, known_seqs, known_pacs, newest_rows)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 185</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_known_data</span>(<span class="ruby-identifier">latest</span>, <span class="ruby-identifier">known_regs</span>, <span class="ruby-identifier">known_seqs</span>, <span class="ruby-identifier">known_pacs</span>, <span class="ruby-identifier">newest_rows</span>)
      <span class="ruby-identifier">lbook</span> = <span class="ruby-constant">Spreadsheet</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">latest</span>)
      <span class="ruby-identifier">idx</span>, <span class="ruby-identifier">prr</span>, <span class="ruby-identifier">prp</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">multiples</span> = {}
      <span class="ruby-identifier">lbook</span>.<span class="ruby-identifier">worksheet</span>(<span class="ruby-value">0</span>).<span class="ruby-identifier">each</span>(<span class="ruby-value">3</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> 
        <span class="ruby-identifier">group</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:product_group</span>))
        <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">group</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'TAM'</span>)
          <span class="ruby-identifier">iksnr</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:iksnr</span>))
          <span class="ruby-identifier">seqnr</span> = <span class="ruby-value str">&quot;%02i&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:seqnr</span>)).<span class="ruby-identifier">to_i</span>
          <span class="ruby-identifier">pacnr</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:ikscd</span>))
          <span class="ruby-identifier">multiples</span>[<span class="ruby-identifier">iksnr</span>] <span class="ruby-operator">||=</span> {}
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prr</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">iksnr</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">prp</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pacnr</span>
            <span class="ruby-identifier">idx</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">previous</span> = <span class="ruby-identifier">multiples</span>[<span class="ruby-identifier">iksnr</span>][<span class="ruby-identifier">pacnr</span>]
            <span class="ruby-identifier">prr</span> = <span class="ruby-identifier">iksnr</span>
            <span class="ruby-identifier">prp</span> = <span class="ruby-identifier">pacnr</span>
            <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">previous</span>[<span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">prr</span> = <span class="ruby-identifier">iksnr</span>
            <span class="ruby-identifier">prp</span> = <span class="ruby-identifier">pacnr</span>
            <span class="ruby-identifier">idx</span> = <span class="ruby-value">0</span>
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">multiples</span>[<span class="ruby-identifier">iksnr</span>][<span class="ruby-identifier">pacnr</span>] = <span class="ruby-identifier">row</span>
          <span class="ruby-identifier">row</span>[<span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">size</span>] = <span class="ruby-identifier">idx</span>
          <span class="ruby-identifier">known_regs</span>.<span class="ruby-identifier">store</span> [<span class="ruby-identifier">iksnr</span>], <span class="ruby-identifier">row</span>
          <span class="ruby-identifier">known_seqs</span>.<span class="ruby-identifier">store</span> [<span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">seqnr</span>], <span class="ruby-identifier">row</span>
          <span class="ruby-identifier">known_pacs</span>.<span class="ruby-identifier">store</span> [<span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">pacnr</span>, <span class="ruby-identifier">idx</span>], <span class="ruby-identifier">row</span>
          (<span class="ruby-identifier">newest_rows</span>[<span class="ruby-identifier">iksnr</span>] <span class="ruby-operator">||=</span> {})[<span class="ruby-identifier">pacnr</span>] = <span class="ruby-identifier">row</span>
        <span class="ruby-keyword kw">end</span>
      }
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">_sort_by</span><span class="method-args">(sort, iksnr, flags)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 255</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_sort_by</span>(<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">flags</span>)
      <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">sort</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:name</span>
        [<span class="ruby-identifier">name</span>(<span class="ruby-ivar">@diff</span>, <span class="ruby-identifier">iksnr</span>), <span class="ruby-identifier">iksnr</span>]
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:registration</span>
        <span class="ruby-identifier">iksnr</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">weight</span> = <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">:new</span>)
                   <span class="ruby-value">0</span>
                 <span class="ruby-keyword kw">elsif</span>(<span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">:delete</span>)
                   <span class="ruby-value">1</span>
                 <span class="ruby-keyword kw">else</span>
                   <span class="ruby-value">2</span>
                 <span class="ruby-keyword kw">end</span>
        [<span class="ruby-identifier">weight</span>, <span class="ruby-identifier">iksnr</span>]
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000001" class="method-detail">
        <a name="M000001"></a>

        <div class="method-heading">
          <a href="#M000001" class="method-signature">
          <span class="method-name">capitalize</span><span class="method-args">(string)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000001-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000001-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 49</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">capitalize</span>(<span class="ruby-identifier">string</span>)
      <span class="ruby-identifier">string</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s+/</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">word</span><span class="ruby-operator">|</span> <span class="ruby-identifier">word</span>.<span class="ruby-identifier">capitalize</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">
          <a href="#M000002" class="method-signature">
          <span class="method-name">cell</span><span class="method-args">(row, pos)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000002-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000002-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 52</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">pos</span>)
      <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">cell</span> = <span class="ruby-identifier">row</span>[<span class="ruby-identifier">pos</span>])
        <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <a href="#M000003" class="method-signature">
          <span class="method-name">column</span><span class="method-args">(key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000003-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000003-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 57</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column</span>(<span class="ruby-identifier">key</span>)
      <span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">key</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000004" class="method-detail">
        <a name="M000004"></a>

        <div class="method-heading">
          <a href="#M000004" class="method-signature">
          <span class="method-name">describe</span><span class="method-args">(diff, iksnr)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000004-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000004-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 60</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">describe</span>(<span class="ruby-identifier">diff</span>, <span class="ruby-identifier">iksnr</span>)
      <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">&quot;%s: %s&quot;</span>, <span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">name</span>(<span class="ruby-identifier">diff</span>, <span class="ruby-identifier">iksnr</span>))
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="#M000005" class="method-signature">
          <span class="method-name">describe_flag</span><span class="method-args">(diff, iksnr, flag)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000005-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000005-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 63</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">describe_flag</span>(<span class="ruby-identifier">diff</span>, <span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">flag</span>)
      <span class="ruby-identifier">txt</span> = <span class="ruby-constant">FLAGS</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">flag</span>, <span class="ruby-identifier">flag</span>)
      <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">flag</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:sequence</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:replaced_package</span>
        <span class="ruby-identifier">pairs</span> = <span class="ruby-identifier">diff</span>.<span class="ruby-identifier">newest_rows</span>[<span class="ruby-identifier">iksnr</span>].<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">rep</span>, <span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">old</span> = <span class="ruby-identifier">diff</span>.<span class="ruby-identifier">replacements</span>[<span class="ruby-identifier">row</span>])
            [<span class="ruby-identifier">old</span>, <span class="ruby-identifier">rep</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">' -&gt; '</span>)
          <span class="ruby-keyword kw">end</span>
        }.<span class="ruby-identifier">compact</span>
        <span class="ruby-identifier">sprintf</span> <span class="ruby-value str">&quot;%s (%s)&quot;</span>, <span class="ruby-identifier">txt</span>, <span class="ruby-identifier">pairs</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">','</span>)
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:registration_date</span>, <span class="ruby-identifier">:expiry_date</span>
        <span class="ruby-identifier">row</span> = <span class="ruby-identifier">diff</span>.<span class="ruby-identifier">newest_rows</span>[<span class="ruby-identifier">iksnr</span>].<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">last</span>
        <span class="ruby-identifier">sprintf</span> <span class="ruby-value str">&quot;%s (%s)&quot;</span>, <span class="ruby-identifier">txt</span>, <span class="ruby-identifier">row</span>[<span class="ruby-identifier">column</span>(<span class="ruby-identifier">flag</span>)].<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">'%d.%m.%Y'</span>)
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">row</span> = <span class="ruby-identifier">diff</span>.<span class="ruby-identifier">newest_rows</span>[<span class="ruby-identifier">iksnr</span>].<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">last</span>
        <span class="ruby-identifier">sprintf</span> <span class="ruby-value str">&quot;%s (%s)&quot;</span>, <span class="ruby-identifier">txt</span>, <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">flag</span>))
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">diff</span><span class="method-args">(target, latest, ignore = [])</span>
          </a>
        </div>
      
        <div class="method-description">
          <h3>Comparison two Excel files</h3>
<table>
<tr><td valign="top"><em>target</em>:</td><td>new file path (String)

</td></tr>
<tr><td valign="top"><em>latest</em>:</td><td>old file path (String)

</td></tr>
<tr><td valign="top"><em>ignore</em>:</td><td>columns not to be comared (Symbol)

</td></tr>
<tr><td valign="top">return  :</td><td>differences (OpenStruct class)

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 90</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">diff</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">latest</span>, <span class="ruby-identifier">ignore</span> = [])
      <span class="ruby-identifier">replacements</span> = {}
      <span class="ruby-identifier">known_regs</span>, <span class="ruby-identifier">known_seqs</span>, <span class="ruby-identifier">known_pacs</span>, <span class="ruby-identifier">newest_rows</span> = <span class="ruby-identifier">known_data</span>(<span class="ruby-identifier">latest</span>)
      <span class="ruby-ivar">@diff</span> = <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">news</span> = <span class="ruby-identifier">news</span> = []
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">updates</span> = <span class="ruby-identifier">updates</span> = []
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">changes</span> = <span class="ruby-identifier">changes</span> = {}
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">newest_rows</span> = <span class="ruby-identifier">newest_rows</span>
      <span class="ruby-constant">Spreadsheet</span>.<span class="ruby-identifier">client_encoding</span> = <span class="ruby-value str">'UTF-8'</span>
      <span class="ruby-identifier">tbook</span> = <span class="ruby-constant">Spreadsheet</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">target</span>)
      <span class="ruby-identifier">sheet</span> = <span class="ruby-identifier">tbook</span>.<span class="ruby-identifier">worksheet</span>(<span class="ruby-value">0</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">new_column</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">sheet</span>.<span class="ruby-identifier">row</span>(<span class="ruby-value">2</span>), <span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">size</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;New column #{COLUMNS.size} (#{new_column})&quot;</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">idx</span>, <span class="ruby-identifier">prr</span>, <span class="ruby-identifier">prp</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">multiples</span> = {}
      <span class="ruby-identifier">tbook</span>.<span class="ruby-identifier">worksheet</span>(<span class="ruby-value">0</span>).<span class="ruby-identifier">each</span>(<span class="ruby-value">3</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">/</span><span class="ruby-value">2</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span> <span class="ruby-identifier">val</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>}.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">/</span><span class="ruby-value">2</span>
          <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Data missing in &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">target</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n(line &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">row</span>.<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;): &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">group</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:product_group</span>))
        <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">group</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'TAM'</span>)
          <span class="ruby-identifier">iksnr</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:iksnr</span>))
          <span class="ruby-identifier">seqnr</span> = <span class="ruby-value str">&quot;%02i&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:seqnr</span>)).<span class="ruby-identifier">to_i</span>
          <span class="ruby-identifier">pacnr</span> = <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:ikscd</span>))
          (<span class="ruby-identifier">multiples</span>[<span class="ruby-identifier">iksnr</span>] <span class="ruby-operator">||=</span> {})
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prr</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">iksnr</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">prp</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pacnr</span>
            <span class="ruby-identifier">idx</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">previous</span> = <span class="ruby-identifier">multiples</span>[<span class="ruby-identifier">iksnr</span>][<span class="ruby-identifier">pacnr</span>]
            <span class="ruby-identifier">prr</span> = <span class="ruby-identifier">iksnr</span>
            <span class="ruby-identifier">prp</span> = <span class="ruby-identifier">pacnr</span>
            <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">previous</span>[<span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">prr</span> = <span class="ruby-identifier">iksnr</span>
            <span class="ruby-identifier">prp</span> = <span class="ruby-identifier">pacnr</span>
            <span class="ruby-identifier">idx</span> = <span class="ruby-value">0</span>
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">row</span>[<span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">size</span>] = <span class="ruby-identifier">idx</span>
          (<span class="ruby-identifier">newest_rows</span>[<span class="ruby-identifier">iksnr</span>] <span class="ruby-operator">||=</span> {})[<span class="ruby-identifier">pacnr</span>] = <span class="ruby-identifier">row</span>
          <span class="ruby-identifier">multiples</span>[<span class="ruby-identifier">iksnr</span>][<span class="ruby-identifier">pacnr</span>] = <span class="ruby-identifier">row</span>
          <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">other</span> = <span class="ruby-identifier">known_regs</span>.<span class="ruby-identifier">delete</span>([<span class="ruby-identifier">iksnr</span>]))
            <span class="ruby-identifier">changes</span>[<span class="ruby-identifier">iksnr</span>] <span class="ruby-operator">||=</span> []
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">changes</span>[<span class="ruby-identifier">iksnr</span>] <span class="ruby-operator">||=</span> [<span class="ruby-identifier">:new</span>]
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">known_seqs</span>.<span class="ruby-identifier">delete</span>([<span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">seqnr</span>])
          <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">other</span> = <span class="ruby-identifier">known_pacs</span>.<span class="ruby-identifier">delete</span>([<span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">pacnr</span>, <span class="ruby-identifier">idx</span>]))
            <span class="ruby-identifier">flags</span> = <span class="ruby-identifier">rows_diff</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">other</span>, <span class="ruby-identifier">ignore</span>)
            (<span class="ruby-identifier">changes</span>[<span class="ruby-identifier">iksnr</span>].<span class="ruby-identifier">concat</span> <span class="ruby-identifier">flags</span>).<span class="ruby-identifier">uniq!</span>
            <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">row</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">replacements</span>.<span class="ruby-identifier">store</span> [ <span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">seqnr</span>, <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:size</span>)), 
                                 <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:unit</span>)) ], <span class="ruby-identifier">row</span>
            <span class="ruby-identifier">flags</span> = <span class="ruby-identifier">changes</span>[<span class="ruby-identifier">iksnr</span>]
            <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">:sequence</span>).<span class="ruby-identifier">uniq!</span> <span class="ruby-keyword kw">unless</span>(<span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">:new</span>)
            <span class="ruby-identifier">news</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">row</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
      }
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">replacements</span> = <span class="ruby-identifier">reps</span> = {}
      <span class="ruby-identifier">known_pacs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span>(<span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">pacnr</span>, <span class="ruby-identifier">idx</span>), <span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">key</span> = [<span class="ruby-identifier">iksnr</span>, <span class="ruby-value str">'%02i'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:seqnr</span>)).<span class="ruby-identifier">to_i</span>, 
                      <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:size</span>)), <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:unit</span>))]
        <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">rep</span> = <span class="ruby-identifier">replacements</span>[<span class="ruby-identifier">key</span>])
          <span class="ruby-identifier">changes</span>[<span class="ruby-identifier">iksnr</span>].<span class="ruby-identifier">push</span> <span class="ruby-identifier">:replaced_package</span>
          <span class="ruby-identifier">reps</span>.<span class="ruby-identifier">store</span> <span class="ruby-identifier">rep</span>, <span class="ruby-identifier">pacnr</span>
        <span class="ruby-keyword kw">end</span>
      }
      <span class="ruby-identifier">known_regs</span>.<span class="ruby-identifier">each_key</span> { <span class="ruby-operator">|</span>(<span class="ruby-identifier">iksnr</span>,<span class="ruby-identifier">_</span>)<span class="ruby-operator">|</span> <span class="ruby-identifier">changes</span>[<span class="ruby-identifier">iksnr</span>] = [<span class="ruby-identifier">:delete</span>] }
      <span class="ruby-identifier">changes</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">flags</span><span class="ruby-operator">|</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">empty?</span> }
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">package_deletions</span> = <span class="ruby-identifier">known_pacs</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
        <span class="ruby-comment cmt">## the keys in known_pacs don't include the sequence number (which</span>
        <span class="ruby-comment cmt">#  would prevent us from properly recognizing multi-sequence-Packages), </span>
        <span class="ruby-comment cmt">#  so we need complete the path to the package now</span>
        <span class="ruby-identifier">key</span>[<span class="ruby-value">1</span>,<span class="ruby-value">0</span>] = <span class="ruby-value str">'%02i'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:seqnr</span>)).<span class="ruby-identifier">to_i</span>
        <span class="ruby-identifier">key</span>
      }
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">sequence_deletions</span> = <span class="ruby-identifier">known_seqs</span>.<span class="ruby-identifier">keys</span>
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">registration_deletions</span> = <span class="ruby-identifier">known_regs</span>.<span class="ruby-identifier">keys</span>
      <span class="ruby-ivar">@diff</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">format_flags</span><span class="method-args">(flags)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 171</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">format_flags</span>(<span class="ruby-identifier">flags</span>)
      <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:revision</span>)
      <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">flag</span><span class="ruby-operator">|</span>
        <span class="ruby-value str">&quot;- %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">FLAGS</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">flag</span>, <span class="ruby-node">&quot;Unbekannt (#{flag})&quot;</span>)
      }.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">known_data</span><span class="method-args">(latest)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 177</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">known_data</span>(<span class="ruby-identifier">latest</span>)
      <span class="ruby-identifier">known_regs</span> = {}
      <span class="ruby-identifier">known_seqs</span> = {}
      <span class="ruby-identifier">known_pacs</span> = {}
      <span class="ruby-identifier">newest_rows</span> = {}
      <span class="ruby-identifier">_known_data</span> <span class="ruby-identifier">latest</span>, <span class="ruby-identifier">known_regs</span>, <span class="ruby-identifier">known_seqs</span>, <span class="ruby-identifier">known_pacs</span>, <span class="ruby-identifier">newest_rows</span>
      [<span class="ruby-identifier">known_regs</span>, <span class="ruby-identifier">known_seqs</span>, <span class="ruby-identifier">known_pacs</span>, <span class="ruby-identifier">newest_rows</span>]
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">name</span><span class="method-args">(diff, iksnr)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 216</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">name</span>(<span class="ruby-identifier">diff</span>, <span class="ruby-identifier">iksnr</span>)
      <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">diff</span>.<span class="ruby-identifier">newest_rows</span>[<span class="ruby-identifier">iksnr</span>]
      <span class="ruby-identifier">row</span> = <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">last</span>
      <span class="ruby-identifier">cell</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">column</span>(<span class="ruby-identifier">:name_base</span>))
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">rows_diff</span><span class="method-args">(row, other, ignore = [])</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 221</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rows_diff</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">other</span>, <span class="ruby-identifier">ignore</span> = [])
      <span class="ruby-identifier">flags</span> = []
      <span class="ruby-constant">COLUMNS</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">ignore</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>) \
           <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">_comparable</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">row</span>, <span class="ruby-identifier">idx</span>) <span class="ruby-operator">!=</span> <span class="ruby-identifier">_comparable</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">other</span>, <span class="ruby-identifier">idx</span>))
          <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">key</span>
        <span class="ruby-keyword kw">end</span>
      }
      <span class="ruby-identifier">flags</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">to_s</span><span class="method-args">(sort=:group)</span>
          </a>
        </div>
      
        <div class="method-description">
          <h3>Output the differencies with String</h3>
<pre>
 This should be called after diff method.
</pre>
<table>
<tr><td valign="top"><em>sort</em> :</td><td>sort key (:group | :<a href="Diff.html#M000010">name</a> | :registration)

</td></tr>
<tr><td valign="top">return :</td><td>difference (String)

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
<span class="ruby-comment cmt"># File lib/swissmedic-diff.rb, line 239</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">sort</span>=<span class="ruby-identifier">:group</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-value str">''</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@diff</span>
      <span class="ruby-ivar">@diff</span>.<span class="ruby-identifier">changes</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">flags</span><span class="ruby-operator">|</span> 
        <span class="ruby-identifier">_sort_by</span>(<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">flags</span>)
      }.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">flags</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">:new</span>)
          <span class="ruby-value str">&quot;+ &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">describe</span>(<span class="ruby-ivar">@diff</span>, <span class="ruby-identifier">iksnr</span>)
        <span class="ruby-keyword kw">elsif</span>(<span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">:delete</span>)
          <span class="ruby-value str">&quot;- &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">describe</span>(<span class="ruby-ivar">@diff</span>, <span class="ruby-identifier">iksnr</span>)
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-value str">&quot;&gt; &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">describe</span>(<span class="ruby-ivar">@diff</span>, <span class="ruby-identifier">iksnr</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;; &quot;</span> \
            <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">flag</span><span class="ruby-operator">|</span> <span class="ruby-identifier">describe_flag</span>(<span class="ruby-ivar">@diff</span>, <span class="ruby-identifier">iksnr</span>, <span class="ruby-identifier">flag</span>) 
          }.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
        <span class="ruby-keyword kw">end</span>
      }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>